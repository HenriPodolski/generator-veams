var config = require('../config');
var size = require('gulp-filesize');
var gulp = require('gulp'); <% if (features.indexOf('sassInsteadOfCompass') != -1) { %>
var sass = require('gulp-sass');
var sourcemaps = require('gulp-sourcemaps'); <% } else { %>
var compass = require('gulp-compass'); <% } %><% if (gulpModules.indexOf('gulp-autoprefixer') != -1) { %>
var autoprefixer = require('gulp-autoprefixer'); <% } %><% if (gulpModules.indexOf('gulp-bless') != -1) { %>
var bless = require('gulp-bless'); <% } %><% if (gulpModules.indexOf('gulp-combine-mq') != -1) { %>
var combineMq = require('gulp-combine-mq'); <% } %>
var minifycss = require('gulp-minify-css');

// Dev Styles Task <% if (features.indexOf('sassInsteadOfCompass') != -1) { %>
gulp.task('styles', function () {
	return gulp.src(config.options.paths.src + '/scss/styles.scss')
		.pipe(sourcemaps.init())
		.pipe(sass())
		.pipe(sourcemaps.write())
		.pipe(gulp.dest(config.options.paths.dev + '/css'))
		.pipe(config.server.reload({stream: true}))
		.pipe(config.notify({message: 'Styles compiled'}))
		.pipe(size());
});

// Dist Styles Task
gulp.task('styles-dist', function () {
	return gulp.src(config.options.paths.src + '/scss/styles.scss')
		.pipe(sass({style: 'expanded'}))
		<% if (gulpModules.indexOf('gulp-autoprefixer') != -1) { %>.pipe(autoprefixer('last 2 version', 'safari 5', 'ie 9', 'opera 12.1', 'ios 7', 'android 4'))<% } %>
		<% if (gulpModules.indexOf('gulp-combine-mq') != -1) { %>.pipe(combineMq({
			beautify: false
		}))<% } %>
		.pipe(minifycss())
		<% if (gulpModules.indexOf('gulp-bless') != -1) { %>.pipe(bless())<% } %>
		.pipe(gulp.dest(config.options.paths.dev + '/css'))
		.pipe(config.notify({message: 'Compiling, minification and autoprefixing of styles completed'})
		.pipe(size());
}); <% } else { %>
gulp.task('styles', function() {
	gulp.src('./src/*.scss')
		.pipe(compass({
			config_file: './config.rb',
			css: config.paths.dev + '/css',
			sass: config.paths.src + '/scss'
		}))
		.pipe(gulp.dest(config.paths.dev + '/css'))
		.pipe(size());
});

// Dist Styles Task
gulp.task('styles-dist', function () {
	return gulp.src(config.options.paths.src + '/scss/styles.scss')
		.pipe(compass({
			config_file: './config.rb',
			css: config.paths.dev + '/css',
			sass: config.paths.src + '/scss'
		}))
		<% if (gulpModules.indexOf('gulp-autoprefixer') != -1) { %>.pipe(autoprefixer('last 2 version', 'safari 5', 'ie 9', 'opera 12.1', 'ios 7', 'android 4'))<% } %>
		<% if (gulpModules.indexOf('gulp-combine-mq') != -1) { %>.pipe(combineMq({
			beautify: false
		}))<% } %>
		.pipe(minifycss())
		<% if (gulpModules.indexOf('gulp-bless') != -1) { %>.pipe(bless())<% } %>
		.pipe(gulp.dest(config.options.paths.dev + '/css'))
		.pipe(config.notify({message: 'Compiling, minification and autoprefixing of styles completed'}))
		.pipe(size());
}); <% } %>
